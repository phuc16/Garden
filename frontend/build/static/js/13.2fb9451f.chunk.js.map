{"version":3,"sources":["app/environment-factors/SoilMoisture.js"],"names":["SoilMoisture","props","data","labels","datasets","label","backgroundColor","borderColor","borderWidth","fill","options","scales","yAxes","ticks","beginAtZero","legend","display","elements","point","radius","state","allSoil","todaySoil","lastData","today","Date","date","getFullYear","getMonth","getDate","nextDate","axios","get","process","then","res","temp","i","length","push","setState","console","log","x","nearestData","todayDataChart","todayColumn","allDataChart","allColumn","this","slice","replace","sumSoil","timeMax","timeMin","changeData","showChart","map","o","value","indexOf","Math","max","min","products","round","StatColumn","dataField","text","sort","className","aria-label","to","aria-current","width","height","id","offset","stopColor","floor","abs","bootstrap4","keyField","columns","defaultActiveKey","eventKey","title","pagination","paginationFactory","sizePerPage","Component"],"mappings":"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","file":"static/js/13.2fb9451f.chunk.js","sourcesContent":["import React, { Component } from 'react';\r\nimport { CircularProgressbarWithChildren } from 'react-circular-progressbar';\r\nimport BootstrapTable from 'react-bootstrap-table-next';\r\nimport { Tabs, Tab } from 'react-bootstrap';\r\nimport { Line } from 'react-chartjs-2';\r\nimport { Link } from 'react-router-dom';\r\nimport paginationFactory from \"react-bootstrap-table2-paginator\";\r\nimport axios from 'axios';\r\n\r\n\r\nclass SoilMoisture extends Component {\r\n  constructor(props){\r\n    super(props);\r\n    this.state = {\r\n      allSoil: [],\r\n      todaySoil : [],\r\n      lastData: 0,\r\n    };\r\n\r\n  }\r\n  async componentDidMount(){\r\n\r\n    var today = new Date();\r\n    var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();\r\n    var nextDate = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+(today.getDate() + 1);\r\n    // console.log(nextDate)\r\n    await axios.get(process.env.REACT_APP_SERVER + `/data`)\r\n    .then(res => {\r\n      let temp = []\r\n      for (let i = 0; i<res.data.length; i++){\r\n        if (res.data[i]['category'] == 'Moist'){\r\n          temp.push(res.data[i])\r\n        }\r\n      }\r\n      this.setState({allSoil: temp})\r\n    })\r\n    console.log('x')\r\n\r\n    await axios.get(process.env.REACT_APP_SERVER + `/data/last`)\r\n    .then(res => {\r\n      var x = 0\r\n      for (let i = 0; i < res.data.length; i++){\r\n        if (res.data[i]['category'] == 'Moist'){\r\n          x = res.data[i]['value']\r\n        }\r\n      }\r\n      console.log(x)\r\n      this.setState({lastData: x})\r\n    })\r\n\r\n    await axios.get(process.env.REACT_APP_SERVER + `/data/search?idGarden=1&startDay=${date}&endDay=${nextDate}`)\r\n    .then(res => {\r\n      let temp = []\r\n      for (let i = 0; i<res.data.length; i++){\r\n        if (res.data[i]['category'] == 'Moist'){\r\n         temp.push(res.data[i])\r\n        }\r\n      }\r\n      this.setState({todaySoil: temp})\r\n    })\r\n\r\n    await axios.get(process.env.REACT_APP_SERVER +  `/data/before-last`)\r\n    .then(res => {\r\n      let x = res.data\r\n      this.setState({nearestData: x['Moist']})\r\n    })\r\n\r\n    \r\n  }\r\n  data = {\r\n    labels: [],\r\n    datasets: [{\r\n      label: 'Today Soil Moisture',\r\n      data: [],\r\n      backgroundColor: [\r\n        'rgba(255, 99, 132, 0.2)',\r\n        'rgba(54, 162, 235, 0.2)',\r\n        'rgba(255, 206, 86, 0.2)',\r\n        'rgba(75, 192, 192, 0.2)',\r\n        'rgba(153, 102, 255, 0.2)',\r\n        'rgba(255, 159, 64, 0.2)'\r\n      ],\r\n      borderColor: [\r\n        'rgba(255,99,132,1)',\r\n        'rgba(54, 162, 235, 1)',\r\n        'rgba(255, 206, 86, 1)',\r\n        'rgba(75, 192, 192, 1)',\r\n        'rgba(153, 102, 255, 1)',\r\n        'rgba(255, 159, 64, 1)'\r\n      ],\r\n      borderWidth: 1,\r\n      fill: true\r\n    }]\r\n  };\r\n\r\n  options = {\r\n      scales: {\r\n        yAxes: [{\r\n          ticks: {\r\n            beginAtZero: true\r\n          }\r\n        }]\r\n      },\r\n      legend: {\r\n        display: true\r\n      },\r\n      elements: {\r\n        point: {\r\n          radius: 0\r\n        }\r\n      }\r\n\r\n  };\r\n\r\n  showChart(){\r\n    var todayDataChart = []\r\n    var todayColumn = []\r\n    var allDataChart = []\r\n    var allColumn = []\r\n    \r\n    for (let i = 0; i< this.state.todaySoil.length; i++){\r\n      todayDataChart.push(this.state.todaySoil[i]['value'])\r\n      todayColumn.push(this.state.todaySoil[i]['time'].slice(11, this.state.todaySoil[i]['time'].length).replace('.000Z', ''))\r\n    }\r\n\r\n    for (let i = 0; i< this.state.allSoil.length; i++){\r\n      allDataChart.push(this.state.allSoil[i]['value'])\r\n      allColumn.push(this.state.allSoil[i]['time'].slice(0, 11).replace('T', ''))\r\n    }\r\n    this.data.labels = todayColumn\r\n    this.data.datasets[0].data = todayDataChart\r\n    console.log(todayColumn)\r\n  }\r\n  render () {\r\n    console.log('render')\r\n    var sumSoil = 0\r\n    var todaySoil = [];\r\n    var timeMax = ''\r\n    var timeMin = ''\r\n    var today = new Date();\r\n    var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();\r\n    var changeData = [this.state.lastData - this.state.nearestData]\r\n    this.showChart()\r\n\r\n    for (let i = 0; i < this.state.todaySoil.length; i++){\r\n      sumSoil += this.state.todaySoil[i]['value']\r\n    }\r\n\r\n    if (this.state.todaySoil.length > 0){\r\n      var temp = []\r\n      temp.push(...this.state.todaySoil.map(o => o.value))\r\n      timeMax = this.state.todaySoil[temp.indexOf(Math.max(...this.state.todaySoil.map(o => o.value)))]['time']\r\n      timeMax = timeMax.replace('T', ', ').replace('.000Z', '')\r\n      timeMin = this.state.todaySoil[temp.indexOf(Math.min(...this.state.todaySoil.map(o => o.value)))]['time']\r\n      timeMin = timeMin.replace('T', ', ').replace('.000Z', '')\r\n    }\r\n\r\n    console.log(this.state.lastData)\r\n    \r\n    const products = [\r\n      {'id': 'Max', 'soil': this.state.todaySoil.length > 0 ? Math.max(...this.state.todaySoil.map(o => o.value)) : 'No data', 'time': timeMax},\r\n      {'id': 'Min', 'soil': this.state.todaySoil.length > 0 ? Math.min(...this.state.todaySoil.map(o => o.value)) : 'No data', 'time': timeMin},\r\n      {'id': 'Avarage', 'soil': this.state.todaySoil.length > 0 ? Math.round((sumSoil/this.state.todaySoil.length)*100)/100  : 'No data' , 'time': date}\r\n    ];\r\n\r\n    const columns = [{\r\n      dataField: 'id',\r\n      text: '', \r\n      sort: true\r\n    }, {\r\n      dataField: 'soil',\r\n      text: 'Moist',\r\n      sort: true\r\n    }, {\r\n      dataField: 'time',\r\n      text: 'Time',\r\n      sort: true\r\n    }\r\n    ];\r\n\r\n    const StatColumn = [{\r\n      dataField: 'id',\r\n      text: 'ID', \r\n      sort: true\r\n    }, {\r\n      dataField: 'value',\r\n      text: 'Value',\r\n      sort: true\r\n    }, {\r\n      dataField: 'time',\r\n      text: 'Time',\r\n      sort: true\r\n    }\r\n    ]\r\n\r\n    \r\n\r\n    return (\r\n      <div>\r\n        <div className=\"page-header\">\r\n          <h3 className=\"page-title\">\r\n            Soil Moisture\r\n          </h3>\r\n          <nav aria-label=\"breadcrumb\">\r\n            <ol className=\"breadcrumb\">\r\n              <li className=\"breadcrumb-item\"><Link to='/dashboard'>Device Control Center</Link></li>\r\n              <li className=\"breadcrumb-item active\" aria-current=\"page\">Soil Moisture</li>\r\n            </ol>\r\n          </nav>\r\n        </div>\r\n        <div className=\"row\"> \r\n          <div className=\"col-xl-3 col-lg-6 col-sm-6 grid-margin stretch-card\">\r\n            <div className=\"card\">\r\n              <div className=\"card-body text-center\">\r\n                <h5 className=\"mb-2 text-dark font-weight-normal\">Soil Moisture</h5>\r\n                <h2 className=\"mb-4 text-dark font-weight-bold\">{this.state.lastData}</h2>\r\n                <div className=\"px-4 d-flex align-items-center\">\r\n                  <svg width=\"0\" height=\"0\">\r\n                    <defs>\r\n                      <linearGradient id=\"progress-order\">\r\n                        <stop offset=\"0%\" stopColor=\"#1579ff\"/>\r\n                        <stop offset=\"100%\" stopColor=\"#7922e5\"/>\r\n                      </linearGradient>\r\n                    </defs>\r\n                  </svg>\r\n                  <CircularProgressbarWithChildren className=\"progress-order\"\r\n                  value={this.state.lastData/10}>\r\n                    <div>\r\n                      <i className=\"mdi mdi-waves icon-md absolute-center text-dark\"></i>\r\n                    </div>\r\n                  </CircularProgressbarWithChildren>\r\n                </div>\r\n                  <p className=\"mt-4 mb-0\">{changeData >= 0 ? 'Increased since' : 'Decreased since' } last time</p>\r\n                  <h3 className=\"mb-0 font-weight-bold mt-2 text-dark\">{Math.floor(Math.abs(changeData)/this.state.nearestData*100)} %</h3>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"col-xl-9 col-lg-6 col-sm-6 grid-margin stretch-card\">\r\n          <div className=\"card\">\r\n          <div className=\"card-body text-center\">\r\n          <h5 className=\"mb-2 text-dark font-weight-normal\">Soil Moisture Overview</h5>\r\n            <BootstrapTable bootstrap4 keyField='id' data={ products } columns={ columns } />\r\n            </div>\r\n          </div>\r\n          </div>\r\n        </div>\r\n        <div className='row'>\r\n        <div className=\"col-md-12\">\r\n              <div className=\"justify-content-between align-items-center tab-transparent\">\r\n        <Tabs defaultActiveKey=\"chart\" id=\"uncontrolled-tab-example\" className=\"mb-3\">\r\n          <Tab eventKey=\"chart\" title=\"Chart\">\r\n          <div className=\"card\">\r\n                <div className=\"card-body\">\r\n                    <h4 className=\"card-title\">Soil Moisture Chart</h4>\r\n                    <Line data={this.data} options={this.options} />\r\n                </div>\r\n            </div>\r\n          </Tab>\r\n          <Tab eventKey=\"today\" title=\"Today\">\r\n          <div className=\"card\">\r\n          <div className=\"card-body text-center\">\r\n          <h5 className=\"mb-2 text-dark font-weight-normal\">Soil Moisture Stats Today</h5>\r\n            <BootstrapTable keyField='id' data={ this.state.todaySoil } columns={ StatColumn  } />\r\n            </div>\r\n          </div>\r\n\r\n          </Tab>\r\n          <Tab eventKey=\"data\" title=\"Data\">\r\n          <div className=\"card\">\r\n            <div className=\"card-body text-center\">\r\n              <h5 className=\"mb-2 text-dark font-weight-normal\">Soil Moisture Stats</h5>\r\n              <BootstrapTable\r\n                bootstrap4 \r\n                keyField='id' \r\n                data={ this.state.allSoil } \r\n                columns={ StatColumn  } \r\n                pagination={paginationFactory({ sizePerPage: 5 })}/>\r\n            </div>\r\n          </div>\r\n          </Tab>\r\n        </Tabs>\r\n        </div>\r\n        </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default SoilMoisture;"],"sourceRoot":""}